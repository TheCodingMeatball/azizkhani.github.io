---
layout: post
title: "Decorator Design Pattern Case Study"
comments: true
---
<p><br /> <br /> Decorator pattern is basically a way to extend functionality of an object by decorating with other objects which can wrap the target object and add their own behavior to it. If you never used or heard of decorators, I highly recommend reading chapter 3 of Head First Design Patterns.<br /> <br /> Pretty much like other patterns mentioned in my posts before, JavaEE has an easy an elegant way to use the decorator pattern. Lets start with a simple stateless session bean.<br /> <br /> <br /> <span style="font-family: Courier New, Courier, monospace;">package com.devchronicles.decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">import javax.ejb.Stateless;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.ejb.TransactionAttribute;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.ejb.TransactionAttributeType;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">/**</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;* @author murat</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*/</span><br /> <span style="font-family: Courier New, Courier, monospace;">@Stateless</span><br /> <span style="font-family: Courier New, Courier, monospace;">@TransactionAttribute(TransactionAttributeType.REQUIRED)</span><br /> <span style="font-family: Courier New, Courier, monospace;">public class EventService {</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; public void startService(){</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println("do something important here...");</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; }</span><br /> <span style="font-family: Courier New, Courier, monospace;">}</span><br /> <br /> To start implementing the decorator pattern, we need an interface so we can bind the decorators and the object to be decorated together.<br /> <br /> <br /> <span style="font-family: Courier New, Courier, monospace;">package com.devchronicles.decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">/**</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;* @author murat</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*/</span><br /> <span style="font-family: Courier New, Courier, monospace;">public interface ServiceInterface {</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; public void startService();</span><br /> <span style="font-family: Courier New, Courier, monospace;">}</span><br /> <br /> The interface has the method which the decorators will add functionality on. Next we need some changes on our existing EventService bean to make it decoratable.<br /> <br /> <br /> <span style="font-family: Courier New, Courier, monospace;">package com.devchronicles.decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">import javax.ejb.Stateless;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.ejb.TransactionAttribute;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.ejb.TransactionAttributeType;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">/**</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;* @author murat</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*/</span><br /> <span style="font-family: Courier New, Courier, monospace;">@Stateless</span><br /> <span style="font-family: Courier New, Courier, monospace;">@TransactionAttribute(TransactionAttributeType.REQUIRED)</span><br /> <span style="font-family: Courier New, Courier, monospace;">public class EventService&nbsp;<span style="color: #cc0000;">implements ServiceInterface</span>{</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; public void startService(){</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println("do something important here...");</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; }</span><br /> <span style="font-family: Courier New, Courier, monospace;">}</span><br /> <br /> <br /> Now we are ready to add as much as decorator we need. All we need to do is to annotate our class, implement the ServiceInterface and to inject our service delegate.<br /> <br /> <br /> <span style="font-family: Courier New, Courier, monospace;">package com.devchronicles.decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">import javax.decorator.Decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.decorator.Delegate;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.inject.Inject;</span><br /> <br /> <span style="font-family: Courier New, Courier, monospace;">/**</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;* @author murat</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*/</span><br /> <span style="color: #0b5394; font-family: Courier New, Courier, monospace;">@Decorator //declares this class as a decorator</span><br /> <span style="font-family: Courier New, Courier, monospace;">public class DecoratorService <span style="color: #38761d;">implements ServiceInterface</span>{ <span style="color: #38761d;">//must implement the service interface</span></span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span style="color: #674ea7;">@Inject //inject the service</span></span><br /> <span style="color: #674ea7; font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; @Delegate //and annotate as the delegate</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; ServiceInterface service;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span style="color: #b45f06;">@Override</span></span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; public void<span style="color: #b45f06;"> startService() </span>{ <span style="color: #b45f06;">//implement the startService method to add functionality</span></span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println("decorating the existing service!");</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #a64d79;"> service.startService(); //let the execution chain continue</span></span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; }&nbsp;</span><br /> <span style="font-family: Courier New, Courier, monospace;">}</span><br /> <br /> Several decorators can be using the service interface.<br /> <br /> <br /> <span style="font-family: Courier New, Courier, monospace;">package com.devchronicles.decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">import javax.decorator.Decorator;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.decorator.Delegate;</span><br /> <span style="font-family: Courier New, Courier, monospace;">import javax.inject.Inject;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">/**</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;* @author murat</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp;*/</span><br /> <span style="font-family: Courier New, Courier, monospace;">@Decorator</span><br /> <span style="font-family: Courier New, Courier, monospace;">public class Decorator2Service implements ServiceInterface{</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;@Inject</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; @Delegate</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; ServiceInterface service;</span><br /> <span style="font-family: Courier New, Courier, monospace;"><br /></span> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; @Override</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; public void startService() {</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; System.out.println("decorating the service even further!!!");</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; service.startService();</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; }</span><br /> <span style="font-family: Courier New, Courier, monospace;">}</span><br /> <br /> Most of the configuration can be done via annotation in JavaEE6. However we still need to add some xml configuration to make decorators work. It might seem disappointing since we already annotated our decorators but still the configuration is pretty simple and needed in order to declare the order of execution. Add the following lines to the empty beans.xml.<br /> <br /> <br /> <span style="font-family: Courier New, Courier, monospace;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&lt;beans xmlns="http://java.sun.com/xml/ns/javaee"</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp;xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/beans_1_0.xsd"&gt;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;decorators&gt;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;class&gt;com.devchronicles.decorator.DecoratorService&lt;/class&gt;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;class&gt;com.devchronicles.decorator.Decorator2Service&lt;/class&gt;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/decorators&gt;</span><br /> <span style="font-family: Courier New, Courier, monospace;">&lt;/beans&gt;</span><br /> <br /> When the startService method of our EventService is executed, the decorators will decorate the ejb and add their own behavior to the execution.<br /> <br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">...</span><br /> <br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">INFO: WEB0671: Loading application [Decorator] at [/Decorator]</span><br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">INFO: Decorator was successfully deployed in 2,534 milliseconds.</span><br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">INFO:&nbsp;decorating the existing service!</span><br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">INFO:&nbsp;decorating the service even further!!!</span><br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">INFO:&nbsp;do something important here...</span><br /> <span style="color: #666666; font-family: Courier New, Courier, monospace;">...</span><br /> <br /> <strong><em>Reference: </em></strong><a href="http://www.devchronicles.com/2012/10/javaee-revisits-design-patterns.html">JavaEE Revisits Design Patterns: Decorator</a></p>
